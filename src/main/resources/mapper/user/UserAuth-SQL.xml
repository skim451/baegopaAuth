<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="userAuth">
	<select id="selectByEmail" parameterType="String" resultType="com.baegopa.auth.dto.UserAuth">
		<![CDATA[
			SELECT * 
			FROM
   				user_auths
   			WHERE
   				email=#{email}
		]]>
	</select>
	
	<select id="selectByToken" parameterType="String" resultType="com.baegopa.auth.dto.UserAuth">
		<![CDATA[
			SELECT
				id, 
    			email, 
    			token, 
    			authed_at,
    			use_yn
			FROM
   				user_auths
   			WHERE
   				token=#{token}
		]]>
	</select>
	
	<insert id="insert" parameterType="com.baegopa.auth.dto.UserAuth">
	    <![CDATA[
	        INSERT INTO user_auths
	        (
	            id, 
	            email, 
	            token, 
	            authed_at, 
	            use_yn
	        )
	        VALUES
	        (
	            0,
	            #{email},
	            #{token}, 
	            NOW(),
	            TRUE
	        )
	    ]]>
	</insert>
	
	<update id="update" parameterType="com.baegopa.auth.dto.UserAuth">
	    <![CDATA[
	        UPDATE user_auths
	        SET
	            token = #{token} ,
	            authed_at = NOW() 
	        WHERE
	            email = #{email}  
	    ]]>
	</update>
	
	<update id="delete" parameterType="String"> 
		<![CDATA[
	        UPDATE user_auths
	        SET
	            use_yn = FALSE
	        WHERE
	            email = #{email}
	    ]]>
	</update>
	
</mapper>